/*
 throbber.js v 0.1 2011-09-18
 http://aino.com

 Copyright (c) 2011, Aino
 Licensed under the MIT license.

*/
(function(window){var document=window.document,M=Math,setTimeout=window.setTimeout,support="getContext"in document.createElement("canvas"),_extend=function(defaults,obj){defaults=defaults||{};for(var i in obj)defaults[i]=obj[i];return defaults},_getRGB=function(color){if(!support)return{rgb:false,alpha:1};var t=document.createElement("i"),rgb;t.style.display="none";t.style.color=color;document.body.appendChild(t);rgb=window.getComputedStyle(t,null).getPropertyValue("color").replace(/^rgba?\(([^\)]+)\)/,
"$1").replace(/\s/g,"").split(",").splice(0,4);document.body.removeChild(t);t=null;return{alpha:rgb.length==4?rgb.pop():1,rgb:rgb}},_restore=function(ctx,size,back){var n=back?-2:2;ctx.translate(size/n,size/n)},fade,i,l,ad,rd,_draw=function(alpha,o,ctx,step){fade=1-alpha||0;ad=1;rd=-1;var size=o.size;if(o.clockwise===false){ad=-1;rd=1}ctx.clearRect(0,0,size,size);ctx.globalAlpha=o.alpha;ctx.lineWidth=o.strokewidth;for(i=0;i<o.lines;i++){l=i+step>=o.lines?i-o.lines+step:i+step;ctx.strokeStyle="rgba("+
o.color.join(",")+","+M.max(0,l/o.lines-fade)+")";ctx.beginPath();ctx.moveTo(size/2,size/2-o.padding/2);ctx.lineTo(size/2,0);ctx.stroke(o.strokewidth);_restore(ctx,size,false);ctx.rotate(ad*(360/o.lines)*M.PI/180);_restore(ctx,size,true)}if(o.rotationspeed){ctx.save();_restore(ctx,size,false);ctx.rotate(rd*(360/o.lines/(20-o.rotationspeed*2))*M.PI/180);_restore(ctx,size,true)}};Throbber=function(options){var elem=this.elem=document.createElement("canvas"),scope=this;if(!isNaN(options))options={size:options};
this.o={size:34,rotationspeed:6,clockwise:true,color:"#fff",fade:300,fallback:false,alpha:1};this.configure(options);this.phase=-1;if(support){this.ctx=elem.getContext("2d");elem.width=elem.height=this.o.size}else if(this.o.fallback){elem=this.elem=new Image;elem.src=this.o.fallback}this.loop=function(){var o=scope.o,alpha=0,fade=1E3/o.fade/o.fps,interval=1E3/o.fps,step=scope.step,style=elem.style,currentStyle=elem.currentStyle,filter=currentStyle&&currentStyle.filter||style.filter,ie="filter"in style&&
o.fallback&&!support;return function(){if(scope.phase==3){alpha-=fade;if(alpha<=0)scope.phase=0}if(scope.phase==1){alpha+=fade;if(alpha>=1)scope.phase=2}if(ie)style.filter="alpha(opacity="+M.min(o.alpha*100,M.max(0,Math.round(alpha*100)))+")";else if(!support&&o.fallback)style.opacity=alpha;else if(support){_draw(alpha,o,scope.ctx,step);step=step===0?scope.o.lines:step-1}window.setTimeout(scope.loop,1E3/o.fps)}}()};Throbber.prototype={constructor:Throbber,appendTo:function(elem){this.elem.style.display=
"none";elem.appendChild(this.elem);return this},configure:function(options){var o=this.o,color;_extend(o,options||{});color=_getRGB(o.color);_extend(o,_extend({padding:o.size/2,strokewidth:M.max(1,M.min(o.size/30,3)),lines:M.min(30,o.size/2+4),alpha:color.alpha||1,fps:M.min(30,o.size+4)},options));o.color=color.rgb;this.step=o.lines;return this},start:function(){this.elem.style.display="block";if(this.phase==-1)this.loop();this.phase=1;return this},stop:function(){this.phase=3;return this},toggle:function(){if(this.phase==
2)this.stop();else this.start()}}})(this);
